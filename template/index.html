<!DOCTYPE html>
<html>
<head>
    <title>LinkedIn Company Website Scraper</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .progress { width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background: #4CAF50; transition: width 0.3s; }
        .status { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .status.running { background: #e3f2fd; }
        .status.completed { background: #e8f5e8; }
        .status.failed { background: #ffebee; }
        button { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
    </style>
</head>
<body>
    <h1>üîç LinkedIn Company Website Scraper</h1>
    
    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <p>Click to upload your Excel file with company names</p>
        <p><small>Supported format: .xlsx</small></p>
        <input type="file" id="fileInput" accept=".xlsx" style="display: none;" onchange="uploadFile()">
    </div>
    
    <div id="status" style="display: none;"></div>
    
    <script>
        let currentJobId = null;
        let statusInterval = null;
        
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.job_id) {
                    currentJobId = data.job_id;
                    document.getElementById('status').style.display = 'block';
                    startStatusPolling();
                } else {
                    alert('Error: ' + data.error);
                }
            })
            .catch(error => {
                alert('Upload failed: ' + error);
            });
        }
        
        function startStatusPolling() {
            statusInterval = setInterval(() => {
                fetch(`/status/${currentJobId}`)
                .then(response => response.json())
                .then(data => {
                    updateStatus(data);
                    if (data.status === 'completed' || data.status === 'failed') {
                        clearInterval(statusInterval);
                    }
                });
            }, 2000);
        }
        
        function updateStatus(data) {
            const statusDiv = document.getElementById('status');
            const progress = data.total > 0 ? (data.progress / data.total * 100) : 0;
            
            let statusClass = data.status;
            let statusText = data.status.toUpperCase();
            
            let html = `
                <div class="status ${statusClass}">
                    <h3>Status: ${statusText}</h3>
                    <div class="progress">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <p>Progress: ${data.progress}/${data.total} companies processed</p>
                    <p>Current: ${data.current_company}</p>
                    <p>Time Elapsed: ${data.elapsed_time}</p>
            `;
            
            if (data.download_ready) {
                html += `<button class="btn-success" onclick="downloadResult()">üì• Download Results</button>`;
            }
            
            html += `</div>`;
            statusDiv.innerHTML = html;
        }
        
        function downloadResult() {
            window.location.href = `/download/${currentJobId}`;
        }
    </script>
</body>
</html>